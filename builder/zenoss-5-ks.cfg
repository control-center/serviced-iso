install
cdrom
lang en_US.UTF-8
keyboard us
network --noipv6 --onboot=yes --bootproto=dhcp --device=link --hostname=DEFAULT_HOSTNAME --activate
rootpw DEFAULT_PASSWORD
firewall --disabled
selinux --disabled
timezone UTC

bootloader --location=mbr
zerombr
clearpart --all --initlabel

part	/boot	--asprimary	--size=512
part    /       --asprimary     --size=40960
part    swap    --asprimary     --size=8192
part    /opt/serviced/var/isvcs --fstype=xfs --size=51200
part    pv.01   --size=51200
part    pv.02   --size=51200    --grow

volgroup docker pv.01
volgroup serviced pv.02

auth --enableshadow --passalgo=sha512 --kickstart
firstboot --disabled

reboot --eject

%packages --nobase --ignoremissing --excludedocs
lvm2
openssh-clients
sudo
kernel-headers
kernel-devel
gcc
make
perl
wget
nfs-utils
net-tools
bzip2
-fprintd-pam
-intltool

# unnecessary firmware
-aic94xx-firmware
-atmel-firmware
-b43-openfwwf
-bfa-firmware
-ipw2100-firmware
-ipw2200-firmware
-ivtv-firmware
-iwl100-firmware
-iwl1000-firmware
-iwl3945-firmware
-iwl4965-firmware
-iwl5000-firmware
-iwl5150-firmware
-iwl6000-firmware
-iwl6000g2a-firmware
-iwl6050-firmware
-libertas-usb8388-firmware
-ql2100-firmware
-ql2200-firmware
-ql23xx-firmware
-ql2400-firmware
-ql2500-firmware
-rt61pci-firmware
-rt73usb-firmware
-xorg-x11-drv-ati-firmware
-zd1211-firmware
%end

%post --nochroot
# Stage installation files
mkdir /mnt/cdrom && mount -t iso9660 -o ro /dev/cdrom /mnt/cdrom
cp -r /mnt/cdrom/zenoss/build /mnt/sysimage/
cp -r /mnt/cdrom/zenoss/common /mnt/sysimage/
umount /mnt/cdrom && rmdir /mnt/cdrom
%end

%post
# Change to a vt to see progress
exec < /dev/tty3 > /dev/tty3
chvt 3
# Install CC/Zenoss
cp /common/install-zenoss.sh /root/install-zenoss.sh && chmod +x /root/install-zenoss.sh
export OFFLINE_INSTALL="Yes"
/root/install-zenoss.sh
rm /root/install-zenoss.sh
%end
