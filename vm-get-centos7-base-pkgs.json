{
  "builders": [
  {
    "type": "virtualbox-ovf",
    "source_path": "output-virtualbox-iso/zenoss-core-deps.ovf",
    "ssh_username": "centos",
    "ssh_password": "centos",
    "shutdown_command": "echo 'packer' | sudo -S shutdown -P now"
  }
],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "mkdir -p tmp/Packages",
        "rpm -qa > tmp/Packages/dependencies.txt",
        "sudo yum -y install yum-utils",
        "pushd tmp/Packages",
        "while read pkg; do yumdownloader $pkg; done < dependencies.txt",
        "popd",
        "tar -czvf tmp/centos7-base-pkgs.tar.gz tmp/Packages"
      ]
    },
    {
      "type": "file",
      "source": "tmp/centos7-base-pkgs.tar.gz",
      "destination": "centos7-base-pkgs.tar.gz",
      "direction": "download"
    }
  ]
}
